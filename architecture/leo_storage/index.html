<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="no-js ie6"><![endif]-->
<!--[if IE 7 ]><html class="no-js ie7"><![endif]-->
<!--[if IE 8 ]><html class="no-js ie8"><![endif]-->
<!--[if IE 9 ]><html class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    
      
        <title>LeoStorage's Architecture - LeoFS Documentation</title>
      
      
      
      
        <meta name="author" content="LeoProject">
      
    
    <meta property="og:url" content="None">
    <meta property="og:title" content="LeoFS Documentation">
    <meta property="og:image" content="None/../../">
    <meta name="apple-mobile-web-app-title" content="LeoFS Documentation">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="../../favicon.ico">
    <link rel="icon" type="image/x-icon" href="../../favicon.ico">
    <style>
      @font-face {
      	font-family: 'Icon';
      	src: url('../../assets/fonts/icon.eot?52m981');
      	src: url('../../assets/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
      		   url('../../assets/fonts/icon.woff?52m981')
               format('woff'),
      		   url('../../assets/fonts/icon.ttf?52m981')
               format('truetype'),
      		   url('../../assets/fonts/icon.svg?52m981#icon')
               format('svg');
      	font-weight: normal;
      	font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="../../assets/stylesheets/application-54f87043f3.css">
    
    
      
      
      
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu+Mono">
      <style>
        body, input {
          font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
        }
        pre, code {
          font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
        }
      </style>
    
    
    <script src="../../assets/javascripts/modernizr-4ab42b99fd.js"></script>
    
  </head>
  
  
  
  <body class=" ">
    
      
      
    
    <div class="backdrop">
      <div class="backdrop-paper"></div>
    </div>
    <input class="toggle" type="checkbox" id="toggle-drawer">
    <input class="toggle" type="checkbox" id="toggle-search">
    <label class="toggle-button overlay" for="toggle-drawer"></label>
    <header class="header">
      <nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        
          <span class="path">
            
              
                Concept and Architecture <i class="icon icon-link"></i>
              
            
          </span>
        
        LeoStorage's Architecture
      </div>
    </div>
    
    
    <div class="button button-search" role="button" aria-label="Search">
      <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
    </div>
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
    </header>
    <main class="main">
      
      <div class="drawer">
        <nav aria-label="Navigation">
  
  <a href="https://github.com/leo-project/leofs" class="project">
    <div class="banner">
      
      <div class="name">
        <strong>
          LeoFS Documentation
          <span class="version">
            
          </span>
        </strong>
        
          <br>
          leo-project/leofs
        
      </div>
    </div>
  </a>
  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            
            <a href="https://github.com/leo-project/leofs/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/leo-project/leofs/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      
      <div class="toc">
        <ul>
          
            
  <li>
    <a class="" title="Introduction" href="../..">
      Introduction
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="What's New?" href="../../whats_new/">
      What's New?
    </a>
    
  </li>

          
            
  <li>
    <span class="section">Getting Started</span>
    <ul>
      
        
  <li>
    <a class="" title="Quick Installation and Setup" href="../../installation/quick/">
      Quick Installation and Setup
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Building a LeoFS' cluster with Ansible" href="../../installation/cluster/">
      Building a LeoFS' cluster with Ansible
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Concept and Architecture</span>
    <ul>
      
        
  <li>
    <a class="" title="LeoFS' Architecture" href="../README/">
      LeoFS' Architecture
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="LeoGateway's Architecture" href="../leo_gateway/">
      LeoGateway's Architecture
    </a>
    
  </li>

      
        
  <li>
    <a class="current" title="LeoStorage's Architecture" href="./">
      LeoStorage's Architecture
    </a>
    
      
        
      
      
        <ul>
          
            <li class="anchor">
              <a title="Fundamentals" href="#fundamentals">
                Fundamentals
              </a>
            </li>
          
            <li class="anchor">
              <a title="Data Structure" href="#data-structure">
                Data Structure
              </a>
            </li>
          
            <li class="anchor">
              <a title="Large Object Support" href="#large-object-support">
                Large Object Support
              </a>
            </li>
          
            <li class="anchor">
              <a title="Related Links" href="#related-links">
                Related Links
              </a>
            </li>
          
        </ul>
      
    
  </li>

      
        
  <li>
    <a class="" title="LeoManager's Architecture" href="../leo_manager/">
      LeoManager's Architecture
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">For Administrators</span>
    <ul>
      
        
  <li>
    <span class="section">Setup</span>
    <ul>
      
        
  <li>
    <a class="" title="Planning for Production" href="../../admin/setup/planning_for_production/">
      Planning for Production
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Supported Platforms" href="../../admin/setup/supported_platforms/">
      Supported Platforms
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Hardware Requirements" href="../../admin/setup/hardware_requirements/">
      Hardware Requirements
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Network Configurations" href="../../admin/setup/network_config/">
      Network Configurations
    </a>
    
  </li>

      
    </ul>
  </li>

      
        
  <li>
    <span class="section">Settings</span>
    <ul>
      
        
  <li>
    <a class="" title="Cluster Settings" href="../../admin/settings/cluster/">
      Cluster Settings
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Environment Configuration" href="../../admin/settings/environment_config/">
      Environment Configuration
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="LeoManager Settings" href="../../admin/settings/leo_manager/">
      LeoManager Settings
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="LeoStorage Settings" href="../../admin/settings/leo_storage/">
      LeoStorage Settings
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="LeoGateway Settings" href="../../admin/settings/leo_gateway/">
      LeoGateway Settings
    </a>
    
  </li>

      
    </ul>
  </li>

      
        
  <li>
    <span class="section">Interface</span>
    <ul>
      
        
  <li>
    <a class="" title="S3-API" href="../../admin/protocols/s3/">
      S3-API
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="REST-API" href="../../admin/protocols/rest/">
      REST-API
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="NFS v3" href="../../admin/protocols/nfs_v3/">
      NFS v3
    </a>
    
  </li>

      
    </ul>
  </li>

      
        
  <li>
    <span class="section">System Operations</span>
    <ul>
      
        
  <li>
    <a class="" title="Operation Flow" href="../../admin/system_operations/flow/">
      Operation Flow
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Systemd Services" href="../../admin/system_operations/systemd/">
      Systemd Services
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="S3-API related Operations" href="../../admin/system_operations/s3/">
      S3-API related Operations
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Cluster Operations" href="../../admin/system_operations/cluster/">
      Cluster Operations
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Data Operations" href="../../admin/system_operations/data/">
      Data Operations
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Multi Data Center Replication" href="../../admin/system_operations/multi_dc_replication/">
      Multi Data Center Replication
    </a>
    
  </li>

      
    </ul>
  </li>

      
        
  <li>
    <span class="section">System Administration</span>
    <ul>
      
        
  <li>
    <a class="" title="Log Management" href="../../admin/system_admin/log_management/">
      Log Management
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Persistent Configuration" href="../../admin/system_admin/persistent_configuration/">
      Persistent Configuration
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="System Migration" href="../../admin/system_admin/migration/">
      System Migration
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="System Integration" href="../../admin/system_admin/integration/">
      System Integration
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Multiple Node Instances" href="../../admin/system_admin/multiple_nodes/">
      Multiple Node Instances
    </a>
    
  </li>

      
    </ul>
  </li>

      
        
  <li>
    <a class="" title="Index of LeoFS' Commands" href="../../admin/index_of_commands/">
      Index of LeoFS' Commands
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <a class="" title="Benchmark" href="../../benchmark/README/">
      Benchmark
    </a>
    
  </li>

          
            
  <li>
    <span class="section">FAQ</span>
    <ul>
      
        
  <li>
    <a class="" title="LeoFS Fundamentals" href="../../faq/fundamentals/">
      LeoFS Fundamentals
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="LeoFS Limits" href="../../faq/limits/">
      LeoFS Limits
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="LeoFS Administration" href="../../faq/administration/">
      LeoFS Administration
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="LeoFS Clients" href="../../faq/client/">
      LeoFS Clients
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <a class="" title="Production Checklist" href="../../production_checklist/README/">
      Production Checklist
    </a>
    
  </li>

          
        </ul>
        
      </div>
    </div>
  </div>
</nav>
      </div>
      <article class="article">
        <div class="wrapper">
          
          <h1 id="leostorages-architecture">LeoStorage's Architecture<a class="headerlink" href="#leostorages-architecture" title="Permanent link">&para;</a></h1>
<h2 id="fundamentals">Fundamentals<a class="headerlink" href="#fundamentals" title="Permanent link">&para;</a></h2>
<p>LeoStorage consists of <strong>the object storage</strong> and <strong>the metadata storage</strong>, and it includes replicator and repairer realize eventual consistency.</p>
<h3 id="write-request-handling">WRITE-Request Handling<a class="headerlink" href="#write-request-handling" title="Permanent link">&para;</a></h3>
<p>A LeoStorage node accepts a request from a LeoGateway node then automatically replicate an object into the LeoStorage cluster. Finally, its LeoStorage node confirms whether a stored object satisfies the consistency rule.</p>
<h3 id="read-request-handling">READ-Request Handling<a class="headerlink" href="#read-request-handling" title="Permanent link">&para;</a></h3>
<p>A LeoGateway node requests a LeoStorage node; then its LeoStorage node retrieves an object from the local object-storage or a remote LeoStorage node. Finally, its LeoStorage node responds an object to its LeoGateway node. Also, its LeoStorage node checks the consistency with the asynchronous processing. Please note that <a href="../../admin/settings/leo_gateway/#cache-consistency-between-leogateway-and-leostorage">LeoGateway cache settings</a> can affect requests handling.</p>
<p>If its LeoStorage node finds inconsistency of an object, its node fixes the inconsistent object with the backend process. Its object eventually keeps consistency with the functions.</p>
<p><img alt="" src="../../assets/leofs-architecture.003.jpg" /></p>
<h2 id="data-structure">Data Structure<a class="headerlink" href="#data-structure" title="Permanent link">&para;</a></h2>
<p>LeoFS’ object consists of three layers which are <strong>metadata</strong>, <strong>needle</strong> and <strong>object-container</strong>.</p>
<ul>
<li><strong>LeoObjectStorage</strong> manages and stores both an object and metadata which stores as a needle.</li>
<li>LeoObjectStorage's metadata-storage handles and stores attributes of an object which includes filename, size, checksum, and others, and it depends on <a href="" target="_blank">Leveldb</a>.</li>
<li>LeoObjectStorage's object-container adopts a log structured file format, which is robust and high performance because an effect of the local file system is just a little part, and LeoStorage is necessary to remove unnecessary objects from the object containers, which is realized by the data compaction feature.</li>
</ul>
<p><img alt="" src="../../assets/leofs-architecture.005.jpg" /></p>
<h2 id="large-object-support">Large Object Support<a class="headerlink" href="#large-object-support" title="Permanent link">&para;</a></h2>
<p>LeoFS supports handling a large size object since v0.12. The purpose of this feature is two things:</p>
<ul>
<li>To equalize disk usage of each LeoStorage node.</li>
<li>To realize high I/O efficiency and high availability.</li>
</ul>
<h3 id="write-request-handling_1">WRITE-Request Handling<a class="headerlink" href="#write-request-handling_1" title="Permanent link">&para;</a></h3>
<p>A LeoGateway node divides a large size object into plural objects, then those chunks are replicated into a LeoStorage cluster which is similar to handling small size objects, and the default chunk size is 5MB, the configuration of which can change a custom chunked object size.</p>
<h3 id="read-request-handling_1">READ-Request Handling<a class="headerlink" href="#read-request-handling_1" title="Permanent link">&para;</a></h3>
<p>A LeoGateway node retrieves a metadata of a requested object, then if it's a large size object, its LeoGateway node retrieves the chunked objects in order of the fragment object number from the LeoStorage cluster. Finally, its LeoGateway node responds the objects to the client.</p>
<p><img alt="" src="../../assets/leofs-architecture.006.jpg" /></p>
<h2 id="related-links">Related Links<a class="headerlink" href="#related-links" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="../../admin/settings/leo_storage/">For Administrators / Settings / LeoStorage Settings</a></li>
<li><a href="../../admin/system_operations/cluster/">For Administrators / System Operations / Cluster Operations</a></li>
</ul>
          <aside class="copyright" role="note">
            
              (c) 2012-2017 LeoProject. All rights reserved. &ndash;
            
            Documentation built with
            <a href="http://www.mkdocs.org" target="_blank">MkDocs</a>
            using the
            <a href="http://squidfunk.github.io/mkdocs-material/" target="_blank">
              Material
            </a>
            theme.
          </aside>
          
            <footer class="footer">
              
  <nav class="pagination" aria-label="Footer">
    <div class="previous">
      
        <a href="../leo_gateway/" title="LeoGateway's Architecture">
          <span class="direction">
            Previous
          </span>
          <div class="page">
            <div class="button button-previous" role="button" aria-label="Previous">
              <i class="icon icon-back"></i>
            </div>
            <div class="stretch">
              <div class="title">
                LeoGateway's Architecture
              </div>
            </div>
          </div>
        </a>
      
    </div>
    <div class="next">
      
        <a href="../leo_manager/" title="LeoManager's Architecture">
          <span class="direction">
            Next
          </span>
          <div class="page">
            <div class="stretch">
              <div class="title">
                LeoManager's Architecture
              </div>
            </div>
            <div class="button button-next" role="button" aria-label="Next">
              <i class="icon icon-forward"></i>
            </div>
          </div>
        </a>
      
    </div>
  </nav>

            </footer>
          
        </div>
      </article>
      <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
          <div class="wrapper">
            <div class="meta"></div>
            <div class="list"></div>
          </div>
        </div>
      </div>
    </main>
    <script>
      var base_url = '../..';
      var repo_id  = 'leo-project/leofs';
    </script>
    <script src="../../assets/javascripts/application-997097ee0c.js"></script>
    
    
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', '//www.google-analytics.com/analytics.js', 'ga');
        /* General initialization */
        ga('create', 'UA-5301881-3', 'leo-project.net');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
        /* Track outbound links */
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
        /* Register handler to log search on blur */
        var query = document.querySelector('.query');
        query.addEventListener('blur', function() {
          if (this.value) {
            var path = document.location.pathname;
            ga('send', 'pageview', path + '?q=' + this.value);
          }
        });
      </script>
    
  </body>
</html>