<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="no-js ie6"><![endif]-->
<!--[if IE 7 ]><html class="no-js ie7"><![endif]-->
<!--[if IE 8 ]><html class="no-js ie8"><![endif]-->
<!--[if IE 9 ]><html class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    
      
        <title>Cluster Settings - LeoFS Documentation</title>
      
      
      
      
        <meta name="author" content="LeoProject">
      
    
    <meta property="og:url" content="None">
    <meta property="og:title" content="LeoFS Documentation">
    <meta property="og:image" content="None/../../../">
    <meta name="apple-mobile-web-app-title" content="LeoFS Documentation">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="../../../favicon.ico">
    <link rel="icon" type="image/x-icon" href="../../../favicon.ico">
    <style>
      @font-face {
      	font-family: 'Icon';
      	src: url('../../../assets/fonts/icon.eot?52m981');
      	src: url('../../../assets/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
      		   url('../../../assets/fonts/icon.woff?52m981')
               format('woff'),
      		   url('../../../assets/fonts/icon.ttf?52m981')
               format('truetype'),
      		   url('../../../assets/fonts/icon.svg?52m981#icon')
               format('svg');
      	font-weight: normal;
      	font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="../../../assets/stylesheets/application-54f87043f3.css">
    
    
      
      
      
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu+Mono">
      <style>
        body, input {
          font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
        }
        pre, code {
          font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
        }
      </style>
    
    
    <script src="../../../assets/javascripts/modernizr-4ab42b99fd.js"></script>
    
  </head>
  
  
  
  <body class=" ">
    
      
      
    
    <div class="backdrop">
      <div class="backdrop-paper"></div>
    </div>
    <input class="toggle" type="checkbox" id="toggle-drawer">
    <input class="toggle" type="checkbox" id="toggle-search">
    <label class="toggle-button overlay" for="toggle-drawer"></label>
    <header class="header">
      <nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        
          <span class="path">
            
              
                For Administrators <i class="icon icon-link"></i>
              
            
              
                Settings <i class="icon icon-link"></i>
              
            
          </span>
        
        Cluster Settings
      </div>
    </div>
    
    
    <div class="button button-search" role="button" aria-label="Search">
      <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
    </div>
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
    </header>
    <main class="main">
      
      <div class="drawer">
        <nav aria-label="Navigation">
  
  <a href="https://github.com/leo-project/leofs" class="project">
    <div class="banner">
      
      <div class="name">
        <strong>
          LeoFS Documentation
          <span class="version">
            
          </span>
        </strong>
        
          <br>
          leo-project/leofs
        
      </div>
    </div>
  </a>
  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            
            <a href="https://github.com/leo-project/leofs/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/leo-project/leofs/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      
      <div class="toc">
        <ul>
          
            
  <li>
    <a class="" title="Introduction" href="../../..">
      Introduction
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="What's New?" href="../../../whats_new/">
      What's New?
    </a>
    
  </li>

          
            
  <li>
    <span class="section">Getting Started</span>
    <ul>
      
        
  <li>
    <a class="" title="Quick Installation and Setup" href="../../../installation/quick/">
      Quick Installation and Setup
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Building a LeoFS' cluster with Ansible" href="../../../installation/cluster/">
      Building a LeoFS' cluster with Ansible
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Concept and Architecture</span>
    <ul>
      
        
  <li>
    <a class="" title="LeoFS' Architecture" href="../../../architecture/README/">
      LeoFS' Architecture
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="LeoGateway's Architecture" href="../../../architecture/leo_gateway/">
      LeoGateway's Architecture
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="LeoStorage's Architecture" href="../../../architecture/leo_storage/">
      LeoStorage's Architecture
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="LeoManager's Architecture" href="../../../architecture/leo_manager/">
      LeoManager's Architecture
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">For Administrators</span>
    <ul>
      
        
  <li>
    <span class="section">Setup</span>
    <ul>
      
        
  <li>
    <a class="" title="Planning for Production" href="../../setup/planning_for_production/">
      Planning for Production
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Supported Platforms" href="../../setup/supported_platforms/">
      Supported Platforms
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Hardware Requirements" href="../../setup/hardware_requirements/">
      Hardware Requirements
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Network Configurations" href="../../setup/network_config/">
      Network Configurations
    </a>
    
  </li>

      
    </ul>
  </li>

      
        
  <li>
    <span class="section">Settings</span>
    <ul>
      
        
  <li>
    <a class="current" title="Cluster Settings" href="./">
      Cluster Settings
    </a>
    
      
        
      
      
        <ul>
          
            <li class="anchor">
              <a title="Prior Knowledge" href="#prior-knowledge">
                Prior Knowledge
              </a>
            </li>
          
            <li class="anchor">
              <a title="Consistency Level" href="#consistency-level">
                Consistency Level
              </a>
            </li>
          
            <li class="anchor">
              <a title="Related Links" href="#related-links">
                Related Links
              </a>
            </li>
          
        </ul>
      
    
  </li>

      
        
  <li>
    <a class="" title="Environment Configuration" href="../environment_config/">
      Environment Configuration
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="LeoManager Settings" href="../leo_manager/">
      LeoManager Settings
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="LeoStorage Settings" href="../leo_storage/">
      LeoStorage Settings
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="LeoGateway Settings" href="../leo_gateway/">
      LeoGateway Settings
    </a>
    
  </li>

      
    </ul>
  </li>

      
        
  <li>
    <span class="section">Interface</span>
    <ul>
      
        
  <li>
    <a class="" title="S3-API" href="../../protocols/s3/">
      S3-API
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="REST-API" href="../../protocols/rest/">
      REST-API
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="NFS v3" href="../../protocols/nfs_v3/">
      NFS v3
    </a>
    
  </li>

      
    </ul>
  </li>

      
        
  <li>
    <span class="section">System Operations</span>
    <ul>
      
        
  <li>
    <a class="" title="Operation Flow" href="../../system_operations/flow/">
      Operation Flow
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Systemd Services" href="../../system_operations/systemd/">
      Systemd Services
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="S3-API related Operations" href="../../system_operations/s3/">
      S3-API related Operations
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Cluster Operations" href="../../system_operations/cluster/">
      Cluster Operations
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Data Operations" href="../../system_operations/data/">
      Data Operations
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Multi Data Center Replication" href="../../system_operations/multi_dc_replication/">
      Multi Data Center Replication
    </a>
    
  </li>

      
    </ul>
  </li>

      
        
  <li>
    <span class="section">System Administration</span>
    <ul>
      
        
  <li>
    <a class="" title="Log Management" href="../../system_admin/log_management/">
      Log Management
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Persistent Configuration" href="../../system_admin/persistent_configuration/">
      Persistent Configuration
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="System Migration" href="../../system_admin/migration/">
      System Migration
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="System Integration" href="../../system_admin/integration/">
      System Integration
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Multiple Node Instances" href="../../system_admin/multiple_nodes/">
      Multiple Node Instances
    </a>
    
  </li>

      
    </ul>
  </li>

      
        
  <li>
    <a class="" title="Index of LeoFS' Commands" href="../../index_of_commands/">
      Index of LeoFS' Commands
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <a class="" title="Benchmark" href="../../../benchmark/README/">
      Benchmark
    </a>
    
  </li>

          
            
  <li>
    <span class="section">FAQ</span>
    <ul>
      
        
  <li>
    <a class="" title="LeoFS Fundamentals" href="../../../faq/fundamentals/">
      LeoFS Fundamentals
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="LeoFS Limits" href="../../../faq/limits/">
      LeoFS Limits
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="LeoFS Administration" href="../../../faq/administration/">
      LeoFS Administration
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="LeoFS Clients" href="../../../faq/client/">
      LeoFS Clients
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <a class="" title="Production Checklist" href="../../../production_checklist/README/">
      Production Checklist
    </a>
    
  </li>

          
        </ul>
        
      </div>
    </div>
  </div>
</nav>
      </div>
      <article class="article">
        <div class="wrapper">
          
          <h1 id="cluster-settings">Cluster Settings<a class="headerlink" href="#cluster-settings" title="Permanent link">&para;</a></h1>
<p>This document outlines the various configuration items to keep in mind when planning a LeoFS system's cluster, and this documentation leads you to be able to configure its cluster when planning and launching it correctly.</p>
<h2 id="prior-knowledge">Prior Knowledge<a class="headerlink" href="#prior-knowledge" title="Permanent link">&para;</a></h2>
<p>LeoFS adopts <a href="https://en.wikipedia.org/wiki/Eventual_consistency">eventual consistency</a> of the consistency model; it takes priority over AP <em>(Availability and Partition tolerance)</em> over C <em>(consistency)</em> which depends on <a href="https://en.wikipedia.org/wiki/CAP_theorem">CAP theorem</a>.</p>
<p>To keep the consistency of objects eventually, LeoFS delivers the replication and recovery feature to automatically fix consistency of objects. You can configure the consistency level of a LeoFS system, and it is affected by the configuration.</p>
<h3 id="how-to-keep-rings-consistency">How to Keep RING's Consistency<a class="headerlink" href="#how-to-keep-rings-consistency" title="Permanent link">&para;</a></h3>
<h4 id="case-1-both-leomanager-nodes-are-unavailable">Case 1: Both LeoManager nodes are unavailable<a class="headerlink" href="#case-1-both-leomanager-nodes-are-unavailable" title="Permanent link">&para;</a></h4>
<p>If both LeoManager nodes are unavailable, LeoStorage and LeoGateway nodes don't update the RING to keep its consistency into the LeoFS system.</p>
<h4 id="case-2-one-leomanager-node-is-unavailable">Case 2: One LeoManager node is unavailable<a class="headerlink" href="#case-2-one-leomanager-node-is-unavailable" title="Permanent link">&para;</a></h4>
<p>If a LeoManager node is unavailable, LeoFS can update the RING, and synchronize it with the LeoFS' system eventually. After restarting another LeoManager node, LeoManager automatically synchronizes the RING between the manager nodes.</p>
<h2 id="consistency-level">Consistency Level<a class="headerlink" href="#consistency-level" title="Permanent link">&para;</a></h2>
<p>Configure the consistency level of a LeoFS system at <a href="https://github.com/leo-project/leofs/blob/master/apps/leo_manager/priv/leo_manager_0.conf" target="_blank">LeoManager's configuration file - leo_manager_0.conf</a>. You need to carefully configure the consistency level because it is not able to change some items after starting the system.</p>
<p>There are four configuration items at <a href="https://github.com/leo-project/leofs/blob/master/apps/leo_manager/priv/leo_manager_0.conf" target="_blank"><code class="codehilite">leo_manager_0.conf</code></a>, items of which have a great impact on <strong>data availability</strong> and <strong>storage performance</strong>.</p>
<table>
<thead>
<tr>
<th>Item</th>
<th align="center">Abbr</th>
<th>Modifiable</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code class="codehilite">consistency.num_of_replicas</code></td>
<td align="center">n</td>
<td>No</td>
<td>1</td>
<td>A number of replicas</td>
</tr>
<tr>
<td><code class="codehilite">consistency.write</code></td>
<td align="center">w</td>
<td>Yes</td>
<td>1</td>
<td>A number of replicas needed for a successful WRITE operation</td>
</tr>
<tr>
<td><code class="codehilite">consistency.read</code></td>
<td align="center">r</td>
<td>Yes</td>
<td>1</td>
<td>A number of replicas needed for a successful READ operation</td>
</tr>
<tr>
<td><code class="codehilite">consistency.delete</code></td>
<td align="center">d</td>
<td>Yes</td>
<td>1</td>
<td>A number of replicas needed for a successful DELETE operation</td>
</tr>
<tr>
<td><code class="codehilite">consistency.rack_aware_replicas</code></td>
<td align="center"></td>
<td>No</td>
<td>0</td>
<td>A number of rack-aware replicas</td>
</tr>
</tbody>
</table>
<h3 id="data-availability-of-consistency-level">Data Availability of Consistency Level<a class="headerlink" href="#data-availability-of-consistency-level" title="Permanent link">&para;</a></h3>
<p>This document delivers the relationship of <code class="codehilite">data availability</code> and <code class="codehilite">configuration level</code> as below:</p>
<table>
<thead>
<tr>
<th>Data Availability</th>
<th>Configuration Level</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Extremely Low</td>
<td>n=2, r=1<br/>w=1, d=1</td>
<td>Data can not be acquired even if two nodes goes down <em>(for personal use)</em></td>
</tr>
<tr>
<td>Low</td>
<td>n=3, r=1<br/>w=1, d=1</td>
<td>Low data consistency</td>
</tr>
<tr>
<td>Middle(1)</td>
<td>n=3, r=1<br/>w=2, d=2</td>
<td>Typical settings</td>
</tr>
<tr>
<td>Middle(2)</td>
<td>n=3, r=2<br/>w=2, d=2</td>
<td>High data consistency than <code class="codehilite">Middle(1)</code></td>
</tr>
<tr>
<td>High</td>
<td>n=3, r=2<br/>w=3, d=3</td>
<td>Data can not be input and removed even if one node goes down</td>
</tr>
<tr>
<td>Extremely High</td>
<td>n=3, r=3<br/>w=3, d=3</td>
<td>Data can not be acquired even if one node goes down <em>(can not be recommended)</em></td>
</tr>
</tbody>
</table>
<h3 id="how-to-change-consistency-level">How To Change Consistency Level<a class="headerlink" href="#how-to-change-consistency-level" title="Permanent link">&para;</a></h3>
<p>You can change <code class="codehilite">consistency.write</code>, <code class="codehilite">consistency.read</code> and <code class="codehilite">consistency.delete</code> of the consistency level that you use the <code class="codehilite">leofs-adm update-consistency-level</code> command, but you cannot update <code class="codehilite">num_of_replicas</code> and <code class="codehilite">rack_aware_replicas</code>.</p>
<pre class="codehilite"><code class="language-bash linenums">## Changes the consistency level to [w:2, d:2, r:1]
$ leofs-adm update-consistency-level 2 2 1</code></pre>


<h2 id="related-links">Related Links<a class="headerlink" href="#related-links" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="../leo_manager/">For Administrators / Settings / LeoManager Settings</a></li>
</ul>
          <aside class="copyright" role="note">
            
              (c) 2012-2017 LeoProject. All rights reserved. &ndash;
            
            Documentation built with
            <a href="http://www.mkdocs.org" target="_blank">MkDocs</a>
            using the
            <a href="http://squidfunk.github.io/mkdocs-material/" target="_blank">
              Material
            </a>
            theme.
          </aside>
          
            <footer class="footer">
              
  <nav class="pagination" aria-label="Footer">
    <div class="previous">
      
        <a href="../../setup/network_config/" title="Network Configurations">
          <span class="direction">
            Previous
          </span>
          <div class="page">
            <div class="button button-previous" role="button" aria-label="Previous">
              <i class="icon icon-back"></i>
            </div>
            <div class="stretch">
              <div class="title">
                Network Configurations
              </div>
            </div>
          </div>
        </a>
      
    </div>
    <div class="next">
      
        <a href="../environment_config/" title="Environment Configuration">
          <span class="direction">
            Next
          </span>
          <div class="page">
            <div class="stretch">
              <div class="title">
                Environment Configuration
              </div>
            </div>
            <div class="button button-next" role="button" aria-label="Next">
              <i class="icon icon-forward"></i>
            </div>
          </div>
        </a>
      
    </div>
  </nav>

            </footer>
          
        </div>
      </article>
      <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
          <div class="wrapper">
            <div class="meta"></div>
            <div class="list"></div>
          </div>
        </div>
      </div>
    </main>
    <script>
      var base_url = '../../..';
      var repo_id  = 'leo-project/leofs';
    </script>
    <script src="../../../assets/javascripts/application-997097ee0c.js"></script>
    
    
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', '//www.google-analytics.com/analytics.js', 'ga');
        /* General initialization */
        ga('create', 'UA-5301881-3', 'leo-project.net');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
        /* Track outbound links */
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
        /* Register handler to log search on blur */
        var query = document.querySelector('.query');
        query.addEventListener('blur', function() {
          if (this.value) {
            var path = document.location.pathname;
            ga('send', 'pageview', path + '?q=' + this.value);
          }
        });
      </script>
    
  </body>
</html>